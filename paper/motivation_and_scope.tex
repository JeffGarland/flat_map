\section{Motivation and Scope}

There has been a strong desire for a more space- and/or runtime-efficient
representation for \code{map} among C++ users for some time now.  This has
motivated discussions among the members of SG14 resulting in a
paper\footnote{See P0038R0,
  \href{http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/p0038r0.html}{here}.},
numerous articles and talks, and an implementation in Boost,
\code{boost::container::flat_map}\footnote{Part of Boost.Container,
  \href{http://www.boost.org/doc/libs/1_61_0/doc/html/container.html}{here}.}.
Virtually everyone who makes games, embedded, or system software in C++ uses
the Boost implementation or one that they rolled themselves.\\

Here are some numbers that show why.  The graphs that follow show runtimes for
different \code{map}-like associative containers.  The containers used are
Boost.FlatMap, \code{map}, \code{unordered_map}, and two thin wrappers over a
sorted \code{vector}.  The ``custom pair'' version of the sorted \code{vector}
uses a simple \code{struct} instead of \code{pair} for its value type.  All
containers use either \code{<int, int>} or \code{<std::string, std::string>}
for the value type.\\

All data in the graphs below were produced on Windows with MSVC 2015, on Linux
with Clang 3.8 and libc++, or on Linux with g++ 4.8.4 and libstdc++.\\

Each set of six graphs shows the performance of a single operation on all
map-variants.  The left column shows the \code{<int, int>} runs, and the right
column shows the \code{<std::string, std::string>} ones.  Each row shows one
platform/compiler configuration. \\

These four sets of graphs cover the most commonly-used operations.  The first
set shows insertion of N elements with random keys; the second shows full
iteration across all N elements; the third shows \code{map.find()} called once
for each key used in the original insertions; and the fourth shows erasure of
all N elements, by the keys used in the original insertions.\\

\subsection{Insert}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=600.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0,500.0,600.0,700.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0107282)(16,0.0154056)(32,0.0201132)(64,0.0430354)(128,0.116275)(256,0.261726)(512,0.515411)(1024,0.939133)(2048,2.26373)(4096,14.9472)(8192,62.1031)(16384,202.501)(32768,556.732)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.011273)(16,0.0142758)(32,0.0248198)(64,0.0643384)(128,0.229556)(256,0.435233)(512,0.590542)(1024,1.31068)(2048,2.06831)(4096,3.35778)(8192,7.14801)(16384,13.3121)(32768,30.8303)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.010253)(16,0.0151146)(32,0.0219452)(64,0.0431486)(128,0.0852888)(256,0.170372)(512,0.342062)(1024,0.684861)(2048,6.7155)(4096,9.94744)(8192,22.0898)(16384,27.2314)(32768,328.261)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=7000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0070268)(16,0.0167056)(32,0.0353396)(64,0.0963944)(128,0.254107)(256,0.902222)(512,3.52088)(1024,12.2972)(2048,39.8929)(4096,133.61)(8192,482.887)(16384,1812.6)(32768,6600.27)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0066768)(16,0.0139818)(32,0.0333436)(64,0.0682806)(128,0.152224)(256,0.329686)(512,0.714662)(1024,1.57226)(2048,3.41602)(4096,7.61822)(8192,17.4112)(16384,39.308)(32768,92.2018)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.007138)(16,0.0161472)(32,0.0344466)(64,0.0896054)(128,0.24183)(256,0.854771)(512,3.38741)(1024,12.016)(2048,39.6661)(4096,133.414)(8192,484.712)(16384,1814.42)(32768,6355.59)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Linux/Clang 3.8},
        xmin=0, xmax=32768,
        ymin=0, ymax=600.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0,500.0,600.0,700.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0107282)(16,0.0154056)(32,0.0201132)(64,0.0430354)(128,0.116275)(256,0.261726)(512,0.515411)(1024,0.939133)(2048,2.26373)(4096,14.9472)(8192,62.1031)(16384,202.501)(32768,556.732)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.011273)(16,0.0142758)(32,0.0248198)(64,0.0643384)(128,0.229556)(256,0.435233)(512,0.590542)(1024,1.31068)(2048,2.06831)(4096,3.35778)(8192,7.14801)(16384,13.3121)(32768,30.8303)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.010253)(16,0.0151146)(32,0.0219452)(64,0.0431486)(128,0.0852888)(256,0.170372)(512,0.342062)(1024,0.684861)(2048,6.7155)(4096,9.94744)(8192,22.0898)(16384,27.2314)(32768,328.261)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=7000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0070268)(16,0.0167056)(32,0.0353396)(64,0.0963944)(128,0.254107)(256,0.902222)(512,3.52088)(1024,12.2972)(2048,39.8929)(4096,133.61)(8192,482.887)(16384,1812.6)(32768,6600.27)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0066768)(16,0.0139818)(32,0.0333436)(64,0.0682806)(128,0.152224)(256,0.329686)(512,0.714662)(1024,1.57226)(2048,3.41602)(4096,7.61822)(8192,17.4112)(16384,39.308)(32768,92.2018)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.007138)(16,0.0161472)(32,0.0344466)(64,0.0896054)(128,0.24183)(256,0.854771)(512,3.38741)(1024,12.016)(2048,39.6661)(4096,133.414)(8192,484.712)(16384,1814.42)(32768,6355.59)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=800.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0,500.0,600.0,700.0,800.0,900.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0053904)(16,0.0107138)(32,0.0270988)(64,0.039834)(128,0.101124)(256,0.288639)(512,0.512539)(1024,1.28297)(2048,3.62618)(4096,14.7995)(8192,61.0981)(16384,207.28)(32768,742.937)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0064678)(16,0.0145128)(32,0.031526)(64,0.0493348)(128,0.128132)(256,0.290392)(512,0.443284)(1024,0.881663)(2048,1.77493)(4096,4.06837)(8192,8.39197)(16384,15.4359)(32768,31.987)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0067052)(16,0.0115246)(32,0.0228948)(64,0.050469)(128,0.140133)(256,0.249419)(512,0.549116)(1024,1.1076)(2048,2.66641)(4096,7.45194)(8192,30.1814)(16384,126.389)(32768,425.099)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=7000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0054072)(16,0.011692)(32,0.0255182)(64,0.0625522)(128,0.150926)(256,0.418668)(512,1.43686)(1024,6.50883)(2048,23.5787)(4096,80.3074)(8192,287.657)(16384,2029.77)(32768,6076.26)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0052238)(16,0.011887)(32,0.023103)(64,0.0480378)(128,0.105137)(256,0.218365)(512,0.455425)(1024,0.998125)(2048,2.07722)(4096,4.54574)(8192,10.4305)(16384,40.9095)(32768,53.7896)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0055602)(16,0.0115224)(32,0.0243732)(64,0.0566144)(128,0.145898)(256,0.406271)(512,1.35226)(1024,6.35033)(2048,23.0451)(4096,79.3106)(8192,284.321)(16384,2524.19)(32768,6316.85)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


Unsurprisingly, insertion takes longer in contiguous-storage implementations.
Boost.FlatMap and a sorted \code{vector<pair<int, int>>} have the steepest
growth curves.  The curve for sorted \code{vector} using a custom
\code{struct} is dramatically flatter in its growth in the \code{<int, int>}
runs.  Note that the custom-pair vector does about the same as the
\code{vector} of \code{pair} in the \code{<std::string, std::string>} runs.

\subsection{Iterate}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0007264)(16,0.0006286)(32,0.0005728)(64,0.000629)(128,0.0009778)(256,0.0007126)(512,0.0013968)(1024,0.0012432)(2048,0.002375)(4096,0.0116216)(8192,0.020296)(16384,0.0196672)(32768,0.0613906)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0009918)(16,0.0010616)(32,0.0012712)(64,0.0023468)(128,0.0053362)(256,0.016608)(512,0.0323784)(1024,0.0667962)(2048,0.18818)(4096,0.656871)(8192,1.39372)(16384,1.92889)(32768,6.09258)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0006006)(16,0.0007122)(32,0.0006288)(64,0.0005864)(128,0.0006282)(256,0.0005868)(512,0.0006708)(1024,0.0007684)(2048,0.0016062)(4096,0.003003)(8192,0.009778)(16384,0.01327)(32768,0.0331886)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0009638)(16,0.0010338)(32,0.0013686)(64,0.0021234)(128,0.00352)(256,0.009624)(512,0.0205336)(1024,0.0309118)(2048,0.0533726)(4096,0.098574)(8192,0.188683)(16384,0.372659)(32768,0.735876)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0011314)(16,0.0016062)(32,0.0025422)(64,0.0049308)(128,0.017069)(256,0.0303252)(512,0.0741714)(1024,0.166362)(2048,0.381543)(4096,0.794682)(8192,1.64244)(16384,3.38516)(32768,6.9833)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0008522)(16,0.0010058)(32,0.001341)(64,0.0021372)(128,0.0035062)(256,0.0151694)(512,0.0194438)(1024,0.0318056)(2048,0.0542948)(4096,0.099468)(8192,0.189437)(16384,0.370508)(32768,0.74631)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Linux/Clang 3.8},
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0007264)(16,0.0006286)(32,0.0005728)(64,0.000629)(128,0.0009778)(256,0.0007126)(512,0.0013968)(1024,0.0012432)(2048,0.002375)(4096,0.0116216)(8192,0.020296)(16384,0.0196672)(32768,0.0613906)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0009918)(16,0.0010616)(32,0.0012712)(64,0.0023468)(128,0.0053362)(256,0.016608)(512,0.0323784)(1024,0.0667962)(2048,0.18818)(4096,0.656871)(8192,1.39372)(16384,1.92889)(32768,6.09258)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0006006)(16,0.0007122)(32,0.0006288)(64,0.0005864)(128,0.0006282)(256,0.0005868)(512,0.0006708)(1024,0.0007684)(2048,0.0016062)(4096,0.003003)(8192,0.009778)(16384,0.01327)(32768,0.0331886)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0009638)(16,0.0010338)(32,0.0013686)(64,0.0021234)(128,0.00352)(256,0.009624)(512,0.0205336)(1024,0.0309118)(2048,0.0533726)(4096,0.098574)(8192,0.188683)(16384,0.372659)(32768,0.735876)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0011314)(16,0.0016062)(32,0.0025422)(64,0.0049308)(128,0.017069)(256,0.0303252)(512,0.0741714)(1024,0.166362)(2048,0.381543)(4096,0.794682)(8192,1.64244)(16384,3.38516)(32768,6.9833)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0008522)(16,0.0010058)(32,0.001341)(64,0.0021372)(128,0.0035062)(256,0.0151694)(512,0.0194438)(1024,0.0318056)(2048,0.0542948)(4096,0.099468)(8192,0.189437)(16384,0.370508)(32768,0.74631)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0006288)(16,0.0007124)(32,0.001229)(64,0.0006706)(128,0.0007126)(256,0.0010616)(512,0.001299)(1024,0.0019976)(2048,0.0029892)(4096,0.0125994)(8192,0.0196256)(16384,0.0293474)(32768,0.0493358)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0010754)(16,0.0013826)(32,0.0023886)(64,0.0034218)(128,0.0081712)(256,0.0183264)(512,0.0486934)(1024,0.123801)(2048,0.327276)(4096,0.736015)(8192,1.45943)(16384,3.03615)(32768,6.37957)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0006566)(16,0.000671)(32,0.0006566)(64,0.0006424)(128,0.0012432)(256,0.0008382)(512,0.0010338)(1024,0.0013828)(2048,0.0018718)(4096,0.0034222)(8192,0.0148202)(16384,0.0199888)(32768,0.02031)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=6.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.000628)(16,0.0006842)(32,0.0008522)(64,0.0010336)(128,0.0014248)(256,0.0022908)(512,0.0081152)(1024,0.014024)(2048,0.024528)(4096,0.0434828)(8192,0.0795632)(16384,0.322066)(32768,0.291057)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.000782)(16,0.0010612)(32,0.0015644)(64,0.0028914)(128,0.0135352)(256,0.0246544)(512,0.059491)(1024,0.150214)(2048,0.338619)(4096,0.688579)(8192,1.4006)(16384,4.33733)(32768,5.93356)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0006144)(16,0.0006704)(32,0.000768)(64,0.0009918)(128,0.001397)(256,0.0022488)(512,0.0042606)(1024,0.0158676)(2048,0.0217626)(4096,0.036471)(8192,0.0649944)(16384,0.298264)(32768,0.239514)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


For all variants but \code{map} and \code{unordered_map}, iteration is
relatively similar, and much faster than \code{map}'s.

\subsection{Find}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=30.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.005113)(16,0.0102244)(32,0.0195558)(64,0.0386496)(128,0.0937254)(256,0.149963)(512,0.496689)(1024,0.599966)(2048,1.22234)(4096,2.88902)(8192,5.93183)(16384,9.98895)(32768,25.8163)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0052236)(16,0.0107272)(32,0.0194726)(64,0.0382162)(128,0.0757206)(256,0.147826)(512,0.309088)(1024,0.58985)(2048,1.19637)(4096,2.72328)(8192,5.56913)(16384,9.71472)(32768,24.1664)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0048748)(16,0.0097772)(32,0.0195278)(64,0.0385112)(128,0.0756658)(256,0.15038)(512,0.296645)(1024,0.595536)(2048,1.3851)(4096,2.83163)(8192,5.74449)(16384,9.83455)(32768,24.4262)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=60.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0,50.0,60.0,70.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0060762)(16,0.0123888)(32,0.025032)(64,0.052504)(128,0.109191)(256,0.227391)(512,0.487196)(1024,1.04212)(2048,2.18573)(4096,4.67721)(8192,9.95407)(16384,21.5232)(32768,46.9673)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.005783)(16,0.0122512)(32,0.024766)(64,0.0516398)(128,0.110279)(256,0.239066)(512,0.516182)(1024,1.11616)(2048,2.39217)(4096,5.29399)(8192,12.5597)(16384,27.0905)(32768,59.4786)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.005825)(16,0.0136178)(32,0.0247928)(64,0.0524512)(128,0.106253)(256,0.222168)(512,0.475994)(1024,1.0183)(2048,2.12132)(4096,4.55145)(8192,9.77859)(16384,20.9983)(32768,45.6506)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Linux/Clang 3.8},
        xmin=0, xmax=32768,
        ymin=0, ymax=30.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.005113)(16,0.0102244)(32,0.0195558)(64,0.0386496)(128,0.0937254)(256,0.149963)(512,0.496689)(1024,0.599966)(2048,1.22234)(4096,2.88902)(8192,5.93183)(16384,9.98895)(32768,25.8163)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0052236)(16,0.0107272)(32,0.0194726)(64,0.0382162)(128,0.0757206)(256,0.147826)(512,0.309088)(1024,0.58985)(2048,1.19637)(4096,2.72328)(8192,5.56913)(16384,9.71472)(32768,24.1664)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0048748)(16,0.0097772)(32,0.0195278)(64,0.0385112)(128,0.0756658)(256,0.15038)(512,0.296645)(1024,0.595536)(2048,1.3851)(4096,2.83163)(8192,5.74449)(16384,9.83455)(32768,24.4262)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=60.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0,50.0,60.0,70.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0060762)(16,0.0123888)(32,0.025032)(64,0.052504)(128,0.109191)(256,0.227391)(512,0.487196)(1024,1.04212)(2048,2.18573)(4096,4.67721)(8192,9.95407)(16384,21.5232)(32768,46.9673)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.005783)(16,0.0122512)(32,0.024766)(64,0.0516398)(128,0.110279)(256,0.239066)(512,0.516182)(1024,1.11616)(2048,2.39217)(4096,5.29399)(8192,12.5597)(16384,27.0905)(32768,59.4786)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.005825)(16,0.0136178)(32,0.0247928)(64,0.0524512)(128,0.106253)(256,0.222168)(512,0.475994)(1024,1.0183)(2048,2.12132)(4096,4.55145)(8192,9.77859)(16384,20.9983)(32768,45.6506)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=30.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0050706)(16,0.0114356)(32,0.0248958)(64,0.0382196)(128,0.0764126)(256,0.152531)(512,0.33443)(1024,0.673794)(2048,1.34513)(4096,2.76759)(8192,5.39175)(16384,10.8341)(32768,21.9027)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0051692)(16,0.0108968)(32,0.0213986)(64,0.0382594)(128,0.146598)(256,0.148677)(512,0.332358)(1024,0.660122)(2048,1.3267)(4096,2.83183)(8192,5.37986)(16384,11.125)(32768,23.6308)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.005503)(16,0.0110044)(32,0.020728)(64,0.0395318)(128,0.129753)(256,0.167172)(512,0.333898)(1024,0.671798)(2048,1.40279)(4096,2.73575)(8192,5.48594)(16384,11.0993)(32768,19.4704)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=40.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0,50.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0046654)(16,0.0098616)(32,0.0193048)(64,0.039291)(128,0.0797742)(256,0.162601)(512,0.336729)(1024,0.697249)(2048,1.49207)(4096,2.97173)(8192,6.34205)(16384,21.3522)(32768,28.1689)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0046656)(16,0.0095544)(32,0.0197914)(64,0.039446)(128,0.0805124)(256,0.169757)(512,0.347234)(1024,0.729438)(2048,1.52257)(4096,3.21096)(8192,7.25176)(16384,25.3301)(32768,34.6683)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0047074)(16,0.0099598)(32,0.0207696)(64,0.039111)(128,0.078907)(256,0.162452)(512,0.338171)(1024,0.697225)(2048,1.43075)(4096,3.01433)(8192,6.29762)(16384,21.3612)(32768,29.6663)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


\code{find()} performance is where things get interesting.  The different
platforms produce strikingly different results.\\

In the MSVC runs, there is a large differentiation between Boost.FlatMap and
\code{map}; in fact, Boost.FlatMap even beats both the sorted \code{vector}
variants.  Also, \code{unordered_map} is the clear winner, regardless of
valkue type.\\

GCC and Clang on Linux produce nearly identical results.  For \code{<int,
  int>} runs, all implementations are nearly identical.  \code{unordered_map}
is faster in the \code{<std::string, std::string>} runs, but all other
variants are very close.

\subsection{Erase}

%%% erase, int, string %%%

Erasure has a nearly identical performance profile to insertion.\\


\subsection{Implications}

Iteration is vastly cheaper for contiguous-storage variants.  Any node-based
associative container will always be slower than a flattened one for
iteration.  For use cases where there is a lot of iteration, this can be the
deciding runtime performance consideration.\\

In all the graphs above, the reason the custom-\code{pair} sorted vector
performs so much better than \code{vector<pair<int, int>>} seems to be that
the custom-\code{pair} type has \code{nothrow} special functions.
Implementing all the special functions and adding \code{nothrow(false)} to
each makes the custom-\code{pair} version perform identically to the
\code{pair<int, int>} version.\\

Boost.FlatMap differs significantly from a sorted \code{vector}.  Clearly
there are a lot of QOI choices that affect the runtime performance of a
standard \code{flat_map}.\\

The fact that insertion and erasure operations produce such similar results
implies that pre-\code{reserve()}ing space will probably not make much
difference when using a flat map.\\

Use cases in which the runtime performance of a flat map would be no better
than \code{map} or \code{unordered_map}, the user may still decide to use a
flat implementation for the storage savings.
