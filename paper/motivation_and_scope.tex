\section{Motivation and Scope}

There has been a strong desire for a more space- and/or runtime-efficient
representation for \code{map} among C++ users for some time now.  This has
motivated discussions among the members of SG14 resulting in a
paper\footnote{See P0038R0,
  \href{http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/p0038r0.html}{here}.},
numerous articles and talks, and an implementation in Boost,
\code{boost::container::flat_map}\footnote{Part of Boost.Container,
  \href{http://www.boost.org/doc/libs/1_61_0/doc/html/container.html}{here}.}.
Virtually everyone who makes games, embedded, or system software in C++ uses
the Boost implementation or one that they rolled themselves.\\

Here are some numbers that show why.  The graphs that follow show runtimes for
different \code{map}-like associative containers.  The containers used are
Boost.FlatMap, \code{map}, and an implementation of a flat map with separate
\code{vector} storage for keys and values (``split storage'').  All containers
use either \code{<int, int>} or \code{<std::string, std::string>}
for the value type.\\

All data in the graphs below were produced on Windows with MSVC 2017, on
Mac OSX with Clang 4.0 and libc++, or on Linux with g++ 6.2 TODO and libstdc++.\\

Each set of six graphs shows the performance of a single operation on all
map-variants.  The left column shows the \code{<int, int>} runs, and the right
column shows the \code{<std::string, std::string>} ones.  Each row shows one
platform/compiler configuration. \\

These three sets of graphs cover the most commonly-used operations (erasure is
left out, since it is nearly identical to insertion).  The first set shows
insertion of N elements with random keys; the second shows full iteration
across all N elements; and the third shows \code{map.find()} called
once for each key used in the original insertionss.\\

\subsection{Insert}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=300.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0010818)(16,0.0022834)(32,0.0044478)(64,0.0084126)(128,0.016404)(256,0.040505)(512,0.112738)(1024,0.298489)(2048,1.02593)(4096,3.51947)(8192,13.2261)(16384,54.3042)(32768,237.076)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0009612)(16,0.001803)(32,0.004867)(64,0.0104578)(128,0.0284224)(256,0.0511984)(512,0.120253)(1024,0.24555)(2048,0.565348)(4096,1.26011)(8192,3.61274)(16384,8.45239)(32768,21.2025)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.002104)(16,0.0030652)(32,0.0057692)(64,0.0144246)(128,0.022775)(256,0.0411042)(512,0.10444)(1024,0.226852)(2048,0.650115)(4096,1.89658)(8192,6.0958)(16384,23.7805)(32768,126.834)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=4000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0019236)(16,0.004328)(32,0.0186898)(64,0.0293248)(128,0.0953096)(256,0.280285)(512,1.00087)(1024,3.6173)(2048,14.6593)(4096,59.6591)(8192,236.797)(16384,933.451)(32768,3696.92)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0016822)(16,0.0028842)(32,0.0063092)(64,0.015803)(128,0.0374404)(256,0.0806422)(512,0.18515)(1024,0.417223)(2048,0.957961)(4096,2.27997)(8192,5.59684)(16384,13.853)(32768,34.6421)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0033648)(16,0.00565)(32,0.0120212)(64,0.028546)(128,0.088218)(256,0.29284)(512,0.964676)(1024,3.59014)(2048,14.3844)(4096,58.4178)(8192,232.801)(16384,923.241)(32768,3658)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Mac OSX/Clang 4.0},
        xmin=0, xmax=32768,
        ymin=0, ymax=300.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.001006)(16,0.0017294)(32,0.0033392)(64,0.0068836)(128,0.0159934)(256,0.0425386)(512,0.114795)(1024,0.353137)(2048,1.13827)(4096,3.96986)(8192,15.2315)(16384,60.4543)(32768,289.981)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0010958)(16,0.0020886)(32,0.0047614)(64,0.011621)(128,0.0267376)(256,0.055884)(512,0.138192)(1024,0.289225)(2048,0.673177)(4096,1.78702)(8192,3.63921)(16384,8.68412)(32768,31.8312)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0014254)(16,0.002552)(32,0.0050186)(64,0.0090264)(128,0.0177444)(256,0.0383664)(512,0.0815692)(1024,0.202268)(2048,0.538179)(4096,1.62411)(8192,5.76629)(16384,22.56)(32768,97.8444)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=5000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0,6000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0020576)(16,0.003742)(32,0.0120596)(64,0.0281826)(128,0.0884814)(256,0.343751)(512,1.20901)(1024,4.89488)(2048,17.222)(4096,69.1194)(8192,279.663)(16384,1092.57)(32768,4458.32)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0015808)(16,0.0031426)(32,0.0060582)(64,0.016902)(128,0.0414376)(256,0.08189)(512,0.211536)(1024,0.510207)(2048,1.08712)(4096,2.73471)(8192,6.70804)(16384,16.6731)(32768,39.6494)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0026934)(16,0.0047848)(32,0.0103552)(64,0.0311424)(128,0.0942302)(256,0.337134)(512,1.28554)(1024,4.84612)(2048,18.4601)(4096,73.2204)(8192,303.305)(16384,1259.94)(32768,4751.6)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=800.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,100.0,200.0,300.0,400.0,500.0,600.0,700.0,800.0,900.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.006886)(16,0.012027)(32,0.025032)(64,0.0646304)(128,0.12792)(256,0.257112)(512,0.520615)(1024,1.34114)(2048,3.8727)(4096,14.74)(8192,61.2479)(16384,185.158)(32768,746.882)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0082838)(16,0.016761)(32,0.035271)(64,0.0716708)(128,0.140327)(256,0.275705)(512,0.619743)(1024,1.3081)(2048,2.00414)(4096,3.80635)(8192,8.52222)(16384,19.094)(32768,31.4365)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0108392)(16,0.0117334)(32,0.0214026)(64,0.0439888)(128,0.178308)(256,0.289425)(512,0.574749)(1024,1.27432)(2048,2.79539)(4096,7.22705)(8192,30.0057)(16384,55.0296)(32768,421.839)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=10000.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0052938)(16,0.013968)(32,0.0267648)(64,0.0603428)(128,0.151581)(256,0.394268)(512,1.44561)(1024,14.6678)(2048,29.4033)(4096,153.071)(8192,676.275)(16384,1107.98)(32768,8673.37)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0051682)(16,0.0119272)(32,0.0225582)(64,0.0500508)(128,0.103643)(256,0.226273)(512,0.463841)(1024,1.57678)(2048,2.09114)(4096,8.25071)(8192,17.8301)(16384,23.6381)(32768,95.2939)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0051968)(16,0.0133408)(32,0.0262328)(64,0.0605934)(128,0.147852)(256,0.382548)(512,4.416)(1024,10.2576)(2048,24.6124)(4096,175.042)(8192,660.752)(16384,1371.62)(32768,9046.95)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


Unsurprisingly, insertion takes longer in contiguous-storage implementations.
Boost.FlatMap has the steepest growth curves by far.  Interestingly, the split
storage implementation is roughly halfway in between \code{map} and
Boost.FlatMap for \code{<int, int>} runs.

\subsection{Iterate}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=3.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,6e-05)(16,0.00012)(32,0.0001802)(64,0.0001202)(128,0.0001802)(256,0.0001804)(512,0.0003006)(1024,0.0007212)(2048,0.0013222)(4096,0.0027044)(8192,0.0092546)(16384,0.0112976)(32768,0.030047)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,6.02e-05)(16,0.000481)(32,0.0010216)(64,0.0024038)(128,0.0039664)(256,0.010877)(512,0.0246382)(1024,0.060755)(2048,0.150776)(4096,0.268019)(8192,0.566265)(16384,1.19058)(32768,2.37293)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0)(16,0.00012)(32,6e-05)(64,0.0003006)(128,0.0003)(256,0.0003004)(512,0.0003)(1024,0.0007812)(2048,0.0011418)(4096,0.0019226)(8192,0.0035456)(16384,0.0072112)(32768,0.0171868)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=4.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.00012)(16,0.0003608)(32,0.000661)(64,0.001082)(128,0.0020432)(256,0.0038462)(512,0.0072714)(1024,0.0176674)(2048,0.0279438)(4096,0.0564884)(8192,0.133409)(16384,0.291696)(32768,0.549199)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0003602)(16,0.000781)(32,0.0010216)(64,0.0028846)(128,0.0058294)(256,0.0168862)(512,0.0475944)(1024,0.0958498)(2048,0.201375)(4096,0.429011)(8192,0.859404)(16384,1.82181)(32768,3.84625)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0003006)(16,0.0003002)(32,0.000541)(64,0.0009014)(128,0.001803)(256,0.0037256)(512,0.0069106)(1024,0.0133414)(2048,0.0268622)(4096,0.053664)(8192,0.109792)(16384,0.243982)(32768,0.49223)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Mac OSX/Clang 4.0},
        xmin=0, xmax=32768,
        ymin=0, ymax=4.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,4.88e-05)(16,4.96e-05)(32,8.5e-05)(64,7.6e-05)(128,0.000115)(256,0.000405)(512,0.0006274)(1024,0.000988)(2048,0.0016076)(4096,0.002919)(8192,0.0093958)(16384,0.0133198)(32768,0.0294976)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0001374)(16,0.0002874)(32,0.0008002)(64,0.002006)(128,0.0092844)(256,0.013855)(512,0.0450856)(1024,0.0904002)(2048,0.185451)(4096,0.386289)(8192,0.767545)(16384,1.60801)(32768,3.60473)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,6.16e-05)(16,4.86e-05)(32,6.78e-05)(64,6.42e-05)(128,0.0001092)(256,0.0003928)(512,0.0003752)(1024,0.0003836)(2048,0.0008122)(4096,0.0015596)(8192,0.0030594)(16384,0.00655)(32768,0.013367)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=5.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0001338)(16,0.0002602)(32,0.0004396)(64,0.0007612)(128,0.001855)(256,0.0034436)(512,0.0063478)(1024,0.0135358)(2048,0.0235806)(4096,0.0483224)(8192,0.0960344)(16384,0.188503)(32768,0.503922)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0002372)(16,0.0006204)(32,0.0008398)(64,0.0043308)(128,0.0099288)(256,0.0258374)(512,0.051671)(1024,0.105724)(2048,0.221674)(4096,0.460978)(8192,0.953628)(16384,1.99573)(32768,4.72012)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.000141)(16,0.0003298)(32,0.000398)(64,0.0008698)(128,0.0023436)(256,0.003188)(512,0.00611)(1024,0.011836)(2048,0.0239278)(4096,0.0501204)(8192,0.0964116)(16384,0.186411)(32768,0.362595)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=7.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0007404)(16,0.0010618)(32,0.0007406)(64,0.0006982)(128,0.0007122)(256,0.0009636)(512,0.0010616)(1024,0.0015644)(2048,0.003017)(4096,0.0056712)(8192,0.0184938)(16384,0.0166504)(32768,0.051445)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0010476)(16,0.0009918)(32,0.0017184)(64,0.0033526)(128,0.0189828)(256,0.0292354)(512,0.052814)(1024,0.107221)(2048,0.342502)(4096,0.716739)(8192,0.905436)(16384,2.86479)(32768,6.38689)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0007538)(16,0.0006286)(32,0.0006288)(64,0.0007404)(128,0.0006844)(256,0.00081)(512,0.0008662)(1024,0.001732)(2048,0.0021792)(4096,0.0037156)(8192,0.0135074)(16384,0.0170694)(32768,0.0216228)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=10.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0008942)(16,0.0006708)(32,0.000768)(64,0.0009916)(128,0.0014666)(256,0.0025564)(512,0.006551)(1024,0.0271402)(2048,0.0248634)(4096,0.0845778)(8192,0.165091)(16384,0.134388)(32768,0.651298)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0006566)(16,0.0009918)(32,0.0015784)(64,0.0031848)(128,0.0109092)(256,0.0213294)(512,0.0958922)(1024,0.241567)(2048,0.344876)(4096,1.03798)(8192,1.97082)(16384,2.8992)(32768,9.00841)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.000573)(16,0.000657)(32,0.0007684)(64,0.0010196)(128,0.0015228)(256,0.0022628)(512,0.0175302)(1024,0.0272662)(2048,0.044852)(4096,0.081449)(8192,0.153414)(16384,0.296742)(32768,0.589601)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


For the variants other than \code{map}, iteration is relatively similar, and
much faster than \code{map}'s.

\subsection{Find}

\begin{tikzpicture}
    \begin{groupplot}[group style={group size=2 by 3, group name=myplot}, width=3.25in]


    \nextgroupplot[
        title={<int, int> Elements},
        xlabel=\empty,
        ylabel={Windows/MSVC 2015},
        xmin=0, xmax=32768,
        ymin=0, ymax=20.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0004206)(16,0.0010816)(32,0.002163)(64,0.0073918)(128,0.0102158)(256,0.0213944)(512,0.0499972)(1024,0.0944054)(2048,0.20372)(4096,0.458514)(8192,0.965587)(16384,1.99026)(32768,4.43632)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0003606)(16,0.0010214)(32,0.002104)(64,0.0098548)(128,0.0105176)(256,0.027343)(512,0.071333)(1024,0.177935)(2048,0.44169)(4096,0.923939)(8192,2.27973)(16384,5.10982)(32768,12.3697)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.000481)(16,0.0010816)(32,0.002404)(64,0.005408)(128,0.0111168)(256,0.0249382)(512,0.0474132)(1024,0.102399)(2048,0.23214)(4096,0.476004)(8192,0.942091)(16384,2.16753)(32768,4.53889)};
        \label{plots:plot2}

    \coordinate (top) at (rel axis cs:0,1);% coordinate at top of the first plot


    \nextgroupplot[
        title={<string, string> Elements},
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=20.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.000541)(16,0.0018022)(32,0.0030652)(64,0.0060098)(128,0.0147228)(256,0.0308266)(512,0.0718678)(1024,0.162672)(2048,0.396557)(4096,0.862765)(8192,1.86791)(16384,4.12359)(32768,9.33799)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0008414)(16,0.0016826)(32,0.0031248)(64,0.0060692)(128,0.0136426)(256,0.0367784)(512,0.0936248)(1024,0.239411)(2048,0.535019)(4096,1.29454)(8192,3.0047)(16384,6.72339)(32768,16.3026)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0009016)(16,0.0012626)(32,0.0030652)(64,0.0061296)(128,0.014663)(256,0.036717)(512,0.0710902)(1024,0.167963)(2048,0.36375)(4096,0.807298)(8192,1.83395)(16384,4.12052)(32768,9.46229)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel={Mac OSX/Clang 4.0},
        xmin=0, xmax=32768,
        ymin=0, ymax=20.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0004866)(16,0.0009706)(32,0.0022824)(64,0.004335)(128,0.0091044)(256,0.0189412)(512,0.0557968)(1024,0.082673)(2048,0.172032)(4096,0.383527)(8192,0.841935)(16384,1.99185)(32768,4.46963)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0004288)(16,0.000884)(32,0.0019048)(64,0.004551)(128,0.0158096)(256,0.0293404)(512,0.0710616)(1024,0.140876)(2048,0.351601)(4096,1.01327)(8192,2.22604)(16384,5.67201)(32768,13.7465)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.000431)(16,0.000929)(32,0.0019342)(64,0.0044758)(128,0.0099912)(256,0.0238202)(512,0.0520456)(1024,0.108687)(2048,0.231379)(4096,0.479146)(8192,0.995161)(16384,2.10164)(32768,4.74943)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel=\empty,
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=30.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0008362)(16,0.001888)(32,0.0052212)(64,0.00879)(128,0.0196282)(256,0.044555)(512,0.0977706)(1024,0.232777)(2048,0.482099)(4096,1.05328)(8192,2.33126)(16384,5.32053)(32768,12.4027)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0011726)(16,0.0018318)(32,0.0041708)(64,0.0109188)(128,0.0248942)(256,0.0525412)(512,0.156154)(1024,0.298466)(2048,0.786893)(4096,1.84109)(8192,4.30504)(16384,9.31911)(32768,20.027)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0007186)(16,0.0018588)(32,0.0034226)(64,0.0078406)(128,0.0324992)(256,0.0397642)(512,0.0878382)(1024,0.196263)(2048,0.428704)(4096,0.938057)(8192,2.17686)(16384,5.91638)(32768,11.8162)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel={Linux/GCC 4.8.4},
        xmin=0, xmax=32768,
        ymin=0, ymax=30.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0058228)(16,0.0114144)(32,0.019877)(64,0.0429094)(128,0.082344)(256,0.169421)(512,0.344959)(1024,0.721774)(2048,1.33655)(4096,2.73441)(8192,5.48793)(16384,9.53107)(32768,22.0512)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0056996)(16,0.0102254)(32,0.0195838)(64,0.0403268)(128,0.0793258)(256,0.16051)(512,0.368542)(1024,0.618014)(2048,1.35856)(4096,2.70511)(8192,4.77139)(16384,11.1934)(32768,23.9401)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0053776)(16,0.0098334)(32,0.0198766)(64,0.0420744)(128,0.0804736)(256,0.161209)(512,0.331142)(1024,0.680382)(2048,1.36476)(4096,2.75949)(8192,5.50087)(16384,11.2875)(32768,19.2332)};
        \label{plots:plot2}


    \nextgroupplot[
        title=\empty,
        xlabel={N},
        ylabel=\empty,
        xmin=0, xmax=32768,
        ymin=0, ymax=60.0,
        xtick={8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536},
        xticklabels={8,,,,,,,,2k,4k,8k,16k,32k,64k},
        ytick={0.0,10.0,20.0,30.0,40.0,50.0,60.0,70.0},
        ymajorgrids=true,
        grid style=dashed,
        scaled x ticks=false,
        scaled y ticks=true,
        ]

    \addplot[color=blue,mark=|,no markers,]
        coordinates {(8,0.0050698)(16,0.0096522)(32,0.0195556)(64,0.040314)(128,0.0795348)(256,0.165597)(512,0.340392)(1024,1.16537)(2048,1.45464)(4096,4.35545)(8192,9.71881)(16384,13.0896)(32768,45.3296)};
        \label{plots:plot0}

    \addplot[color=red,mark=|,no markers,]
        coordinates {(8,0.0046372)(16,0.00968)(32,0.0191502)(64,0.0390134)(128,0.0807732)(256,0.172696)(512,0.46503)(1024,1.0416)(2048,1.5437)(4096,5.28071)(8192,11.3394)(16384,16.1867)(32768,56.8139)};
        \label{plots:plot1}

    \addplot[color=green,mark=|,no markers,]
        coordinates {(8,0.0046234)(16,0.0096524)(32,0.0202528)(64,0.0388602)(128,0.0792)(256,0.163498)(512,0.450954)(1024,0.954952)(2048,2.09072)(4096,4.33874)(8192,9.53566)(16384,20.9074)(32768,46.7286)};
        \label{plots:plot2}

    \coordinate (bot) at (rel axis cs:1,0);% coordinate at bottom of the last plot

    \end{groupplot}

    \path (myplot c1r1.outer north west)% plot in column 1 row 1
          -- node[anchor=south,rotate=90] {Time [milliseconds]}% label midway
          (myplot c1r3.outer south west);% plot in column 1 row 3

    % legend
    \path (myplot c1r3.south west|-current bounding box.south)--
      coordinate(legendpos)
      (myplot c2r3.south east|-current bounding box.south);
    \matrix[
        matrix of nodes,
        anchor=south,
        draw,
        inner sep=0.2em,
        draw
      ]at([yshift=-5ex]legendpos)
      {
        \ref{plots:plot0}& Boost.FlatMap&[5pt]
        \ref{plots:plot1}& std::map&[5pt]
        \ref{plots:plot2}& split\_map\_t&[5pt]\\
      };

\end{tikzpicture}
\\
\\


\code{find()} performance is where things get interesting.  The different
platforms produce somewhat similar results.\\

Though the curves look different for GCC, in all cases \code{find()} is
markedly slower for \code{map} than for the flat implementations.


\subsection{Implications}

Iteration is vastly cheaper for contiguous-storage variants.  Any node-based
associative container will always be slower than a flattened one for
iteration.  For use cases where there is a lot of iteration, this can be the
deciding runtime performance consideration.\\

Find operations are also cheaper for congituous-storage variants, though not
as clearly as so as iteration operations.\\

Use cases in which iteration and lookup are much more frequent than insertion
and deletion suggest the use of a flat implementation.\\

Use cases in which the runtime performance of a flat map would be no better
than \code{map} or \code{unordered_map}, the user may still decide to use a
flat implementation for the storage savings.
